<Configurations>
  <Configuration topology="XM0" version="9.1 Initial Release" wrapper="PSTemplates\Sitecore91.ps1" scriptmaps="GLOBAL|INSTALL|UNINSTALL">
    <File type="data" name="Sitecore XM 9.1.0 rev. 001564 (OnPrem)_cm.scwdp.zip" />
    <File type="data" name="Sitecore.IdentityServer 2.0.0 rev. 00157 (OnPrem)_identityserver.scwdp.zip" />
    <File type="config" name="identityserver.json" />
    <File type="config" name="createcert.json" />
    <File type="config" name="sitecore-solr.json" />
    <File type="config" name="sitecore-XM1-cm.json" />
    <ScriptMaps>
      <ScriptMap location="GLOBAL">
        <![CDATA[
        $Prefix = "[PREFIX]"
        $SitecoreAdminPassword = "b" #neverForget
        $SCInstallRoot = "[DATA_FOLDER]"
        $SitecoreContentManagementSitename = "[SITENAME]"
        $IdentityServerSiteName = "[ID_SITENAME]"
        $LicenseFile = "[LICENSE_FILE]"
        $SolrUrl = "[SOLR_URL]"
        $SolrRoot = "[SOLR_ROOT]"
        $SolrService = "[SOLR_SERVICE]"
        $SqlServer = "[SQL_SERVER]"
        $SqlAdminUser = "[SQL_USER]"
        $SqlAdminPassword = "[SQL_PASSWORD]"
        $SiteCoreContentManagementPackage = (Get-ChildItem "$SCInstallRoot\Sitecore XM 9.1.0 rev. 001564 (OnPrem)_cm.scwdp.zip").FullName
        $IdentityServerPackage = (Get-ChildItem "$SCInstallRoot\Sitecore.IdentityServer 2.0.0 rev. 00157 (OnPrem)_identityserver.scwdp.zip").FullName
        $PasswordRecoveryUrl = "http://$SitecoreContentManagementSitename"
        $SitecoreIdentityAuthority = "https://$IdentityServerSiteName"
        $ClientSecret = "SIF-Default"
        $SitecoreSecurePassword = 'Sitecor3SecureP4ssword!'
        $AllowedCorsOrigins = "https://$SitecoreContentManagementSitename"
        
        $SiteFolder = "C:\inetpub\wwwroot\$SitecoreContentManagementSitename"    
        $IdentitySiteFolder = "C:\inetpub\wwwroot\$IdentityServerSiteName"  

      ]]>
      </ScriptMap>
      <ScriptMap location="INSTALL">
        <![CDATA[
      $certParams = @{
          Path = "$SCInstallRoot\createcert.json"
          CertificateName = $IdentityServerSiteName
      }

      Install-SitecoreConfiguration @certParams

      $idServerParams = @{
          Path = "$SCInstallRoot\identityserver.json"
          Package = $IdentityServerPackage
          SqlDbPrefix = $Prefix
          SitecoreIdentityCert = $IdentityServerSiteName
          LicenseFile = $LicenseFile
          SiteName = $IdentityServerSiteName
          SqlCorePassword = $SitecoresecurePassword
          SqlServer = $SqlServer
          PasswordRecoveryUrl = $PasswordRecoveryUrl
          AllowedCorsOrigins = $AllowedCorsOrigins
          ClientSecret = $ClientSecret
      }


      Install-SitecoreConfiguration @idServerParams

      $solrParams = @{
          Path = "$SCInstallRoot\sitecore-solr.json"
          SolrUrl = $SolrUrl
          SolrRoot = $SolrRoot
          SolrService = $SolrService
          CorePrefix = $Prefix
      }

      Install-SitecoreConfiguration @solrParams

      $cmParams = @{
          Path = "$SCInstallRoot\sitecore-XM1-cm.json"
          Package = $SiteCoreContentManagementPackage
          LicenseFile = $LicenseFile
          SqlDbPrefix = $Prefix
          SolrCorePrefix = $Prefix
          SiteName = $SitecoreContentManagementSitename
          SitecoreAdminPassword = $SitecoreAdminPassword
          SqlServer = $SqlServer
          SqlAdminUser = $SqlAdminUser
          SqlAdminPassword = $SqlAdminPassword
          SqlSecurityPassword = $SitecoresecurePassword
          SqlCorePassword = $SitecoresecurePassword
          SqlMasterPassword = $SitecoresecurePassword
          SqlWebPassword = $SitecoresecurePassword
          SqlFormsPassword = $SitecoresecurePassword
          SolrUrl = $SolrUrl
          SitecoreIdentityAuthority = $SitecoreIdentityAuthority
   
      }

      Install-SitecoreConfiguration @cmParams
      ]]>
      </ScriptMap>
      <ScriptMap location="UNINSTALL">
        <![CDATA[
  RemoveSolrCores
  
  RemoveDatabase("Core")
  RemoveDatabase("ExperienceForms")
  RemoveDatabase("Master")
  RemoveDatabase("Web")

  RemoveWebsite($SitecoreContentManagementSitename)
  RemoveWebsite($IdentityServerSiteName)
  
  RemoveFolder($SiteFolder) 
  RemoveFolder($IdentitySiteFolder)
        ]]>
      </ScriptMap>
    </ScriptMaps>
    <Fields>
      <Field name="sitename" type="text" map="SITENAME" label="Site Name" description="The Name of the Website"  defaultValue="[[PREFIX]].sc"/>
      <Field name="id_sitename" type="text" map="ID_SITENAME" label="Identity Site Name" description="The Name of the Identify Server Website"  defaultValue="[[PREFIX]].identityserver"/>
    </Fields>
  </Configuration>
  <Configuration topology="XM1" version="9.1 Initial Release" wrapper="PSTemplates\Sitecore91.ps1" scriptmaps="GLOBAL|INSTALL|UNINSTALL">
    <File type="data" name="Sitecore XM 9.1.0 rev. 001564 (OnPrem)_cm.scwdp.zip" />
    <File type="data" name="Sitecore XM 9.1.0 rev. 001564 (OnPrem)_cd.scwdp.zip" />
    <File type="data" name="Sitecore.IdentityServer 2.0.0 rev. 00157 (OnPrem)_identityserver.scwdp.zip" />

    <File type="config" name="identityserver.json" />
    <File type="config" name="createcert.json" />
    <File type="config" name="sitecore-solr.json" />
    <File type="config" name="sitecore-XM1-cm.json" />
    <File type="config" name="sitecore-XM1-cd.json" />
    <ScriptMaps>
      <ScriptMap location="GLOBAL">
        <![CDATA[
        $Prefix = "[PREFIX]"
        $SitecoreAdminPassword = "b" #neverForget
        $SCInstallRoot = "[DATA_FOLDER]"
        $SitecoreContentManagementSitename = "[CM_SITENAME]"
        $SitecoreContentDeliverySitename = "[CD_SITENAME]"
        $IdentityServerSiteName = "[ID_SITENAME]"
        $LicenseFile = "[LICENSE_FILE]"
        $SolrUrl = "[SOLR_URL]"
        $SolrRoot = "[SOLR_ROOT]"
        $SolrService = "[SOLR_SERVICE]"
        $SqlServer = "[SQL_SERVER]"
        $SqlAdminUser = "[SQL_USER]"
        $SqlAdminPassword = "[SQL_PASSWORD]"
        $SiteCoreContentManagementPackage = (Get-ChildItem "$SCInstallRoot\Sitecore XM 9.1.0 rev. 001564 (OnPrem)_cm.scwdp.zip").FullName
        $SiteCoreContentDeliveryPackage = (Get-ChildItem "$SCInstallRoot\Sitecore XM 9.1.0 rev. 001564 (OnPrem)_cd.scwdp.zip").FullName
        $IdentityServerPackage = (Get-ChildItem "$SCInstallRoot\Sitecore.IdentityServer 2.0.0 rev. 00157 (OnPrem)_identityserver.scwdp.zip").FullName
        $PasswordRecoveryUrl = "http://$SitecoreContentManagementSitename"
        $SitecoreIdentityAuthority = "https://$IdentityServerSiteName"
        $ClientSecret = "SIF-Default"
        $SitecoreSecurePassword = 'Sitecor3SecureP4ssword!'
        $AllowedCorsOrigins = "https://$SitecoreContentManagementSitename"
        
        $SiteFolder = "C:\inetpub\wwwroot\$SitecoreContentManagementSitename"    
        $SiteFolderCD = "C:\inetpub\wwwroot\$SitecoreContentDeliverySitename"    
        $IdentitySiteFolder = "C:\inetpub\wwwroot\$IdentityServerSiteName"  

      ]]>
      </ScriptMap>
      <ScriptMap location="INSTALL">
        <![CDATA[
      $certParams = @{
          Path = "$SCInstallRoot\createcert.json"
          CertificateName = $IdentityServerSiteName
      }

      Install-SitecoreConfiguration @certParams

      $idServerParams = @{
          Path = "$SCInstallRoot\identityserver.json"
          Package = $IdentityServerPackage
          SqlDbPrefix = $Prefix
          SitecoreIdentityCert = $IdentityServerSiteName
          LicenseFile = $LicenseFile
          SiteName = $IdentityServerSiteName
          SqlCorePassword = $SitecoresecurePassword
          SqlServer = $SqlServer
          PasswordRecoveryUrl = $PasswordRecoveryUrl
          AllowedCorsOrigins = $AllowedCorsOrigins
          ClientSecret = $ClientSecret
      }


      Install-SitecoreConfiguration @idServerParams

      $solrParams = @{
          Path = "$SCInstallRoot\sitecore-solr.json"
          SolrUrl = $SolrUrl
          SolrRoot = $SolrRoot
          SolrService = $SolrService
          CorePrefix = $Prefix
      }

      Install-SitecoreConfiguration @solrParams

      $cmParams = @{
          Path = "$SCInstallRoot\sitecore-XM1-cm.json"
          Package = $SiteCoreContentManagementPackage
          LicenseFile = $LicenseFile
          SqlDbPrefix = $Prefix
          SolrCorePrefix = $Prefix
          SiteName = $SitecoreContentManagementSitename
          SitecoreAdminPassword = $SitecoreAdminPassword
          SqlServer = $SqlServer
          SqlAdminUser = $SqlAdminUser
          SqlAdminPassword = $SqlAdminPassword
          SqlSecurityPassword = $SitecoresecurePassword
          SqlCorePassword = $SitecoresecurePassword
          SqlMasterPassword = $SitecoresecurePassword
          SqlWebPassword = $SitecoresecurePassword
          SqlFormsPassword = $SitecoresecurePassword
          SolrUrl = $SolrUrl
          SitecoreIdentityAuthority = $SitecoreIdentityAuthority
   
      }

      Install-SitecoreConfiguration @cmParams
      
       $cdParams = @{
          Path = "$SCInstallRoot\sitecore-XM1-cd.json"
          Package = $SiteCoreContentDeliveryPackage
          LicenseFile = $LicenseFile
          SqlDbPrefix = $Prefix
          SolrCorePrefix = $Prefix
          SiteName = $SitecoreContentDeliverySitename
          SqlServer = $SqlServer
          SqlSecurityPassword = $SitecoresecurePassword
          SqlWebPassword = $SitecoresecurePassword
          SqlFormsPassword = $SitecoresecurePassword
          SolrUrl = $SolrUrl
          SitecoreIdentityAuthority = $SitecoreIdentityAuthority
   
      }

      Install-SitecoreConfiguration @cdParams
      ]]>
      </ScriptMap>
      <ScriptMap location="UNINSTALL">
        <![CDATA[
  RemoveSolrCores
  
  RemoveDatabase("Core")
  RemoveDatabase("ExperienceForms")
  RemoveDatabase("Master")
  RemoveDatabase("Web")

  RemoveWebsite($SitecoreContentManagementSitename)
  RemoveWebsite($SitecoreContentDeliverySitename)
  RemoveWebsite($IdentityServerSiteName)
  
  RemoveFolder($SiteFolder) 
  RemoveFolder($SiteFolderCD)
  RemoveFolder($IdentitySiteFolder)
        ]]>
      </ScriptMap>
    </ScriptMaps>
    <Fields>
      <Field name="cm_sitename" type="text" map="CM_SITENAME" label="CM Site Name" description="The Name of the Content Authoring Website"  defaultValue="[[PREFIX]].sc-cm"/>
      <Field name="cd_sitename" type="text" map="CD_SITENAME" label="CD Site Name" description="The Name of the Content Delivery Website"  defaultValue="[[PREFIX]].sc-cd"/>
      <Field name="id_sitename" type="text" map="ID_SITENAME" label="Identity Site Name" description="The Name of the Identify Server Website"  defaultValue="[[PREFIX]].identityserver"/>
    </Fields>
  </Configuration>
  <Configuration topology="XP0" version="9.0 Initial Release" wrapper="PSTemplates\Sitecore9.ps1" scriptmaps="GLOBAL|INSTALL|UNINSTALL">
    <File type="data" name="Sitecore 9.0.0 rev. 171002 (OnPrem)_single.scwdp.zip" />
    <File type="data" name="Sitecore 9.0.0 rev. 171002 (OnPrem)_xp0xconnect.scwdp.zip" />
    <File type="config" name="xconnect-createcert.json" />
    <File type="config" name="xconnect-solr.json"/>
    <File type="config" name="sitecore-solr.json" />
    <File type="config" name="xconnect-xp0.json" />
    <File type="config" name="sitecore-XP0.json" />
    <ScriptMaps>
      <ScriptMap location="GLOBAL">
        <![CDATA[
$Prefix = '[PREFIX]'
$PSScriptRoot = '[DATA_FOLDER]'
$SolrUrl = '[SOLR_URL]'
$SolrRoot = '[SOLR_ROOT]'
$SolrService = '[SOLR_SERVICE]'
$SqlServer = '[SQL_SERVER]'
$SqlAdminUser = '[SQL_USER]'
$SqlAdminPassword = '[SQL_PASSWORD]'
$LicenseFilePath = '[LICENSE_FILE]'
$xConnectCertName = "$Prefix.xconnect_client"
$xConnectSiteName = '[XCONNECT_SITE]'
$SiteName = '[SITENAME]'
$SiteFolder = "C:\inetpub\wwwroot\$SiteName"      
$xConnectSiteFolder = "C:\inetpub\wwwroot\$xConnectSiteName"    
$SecurePassword = 'Sitecor3SecureP4ssword!'
      ]]>
      </ScriptMap>
      <ScriptMap location="INSTALL">
        <![CDATA[
  $certParams = @{
    Path = "$PSScriptRoot\xconnect-createcert.json"
    CertificateName = $xConnectCertName 
  }
  Install-SitecoreConfiguration @certParams -Verbose
    
  $solrParams = @{
    Path = "$PSScriptRoot\xconnect-solr.json"
    SolrUrl = $SolrUrl
    SolrRoot = $SolrRoot
    SolrService = $SolrService
    CorePrefix = $Prefix
  }
  Install-SitecoreConfiguration @solrParams
  
  $xconnectParams = @{
    Path = "$PSScriptRoot\xconnect-xp0.json"
    Package = "$PSScriptRoot\Sitecore 9.0.0 rev. 171002 (OnPrem)_xp0xconnect.scwdp.zip"
    LicenseFile = $LicenseFilePath
    Sitename = $xConnectSiteName
    XConnectCert = $xConnectCertName 
    SqlDbPrefix = $Prefix
    SqlServer = $SqlServer
    SqlAdminUser = $SqlAdminUser
    SqlAdminPassword = $SqlAdminPassword
    SolrCorePrefix = $Prefix
    SolrURL = $SolrUrl
    SqlCollectionPassword = $SecurePassword
    SqlProcessingPoolsPassword = $SecurePassword
    SqlReferenceDataPassword = $SecurePassword
    SqlMarketingAutomationPassword = $SecurePassword
  }
  Install-SitecoreConfiguration @xconnectParams
  
  $solrParams = @{
    Path = "$PSScriptRoot\sitecore-solr.json"
    SolrUrl = $SolrUrl
    SolrRoot = $SolrRoot
    SolrService = $SolrService
    CorePrefix = $Prefix
  }
  Install-SitecoreConfiguration @solrParams
    
  $sitecoreParams = @{
    Path = "$PSScriptRoot\sitecore-XP0.json"
    Package = "$PSScriptRoot\Sitecore 9.0.0 rev. 171002 (OnPrem)_single.scwdp.zip"
    LicenseFile = $LicenseFilePath
    Sitename = $SiteName
    XConnectCert = $xConnectCertName 
    SqlDbPrefix = $Prefix
    SqlServer = $SqlServer
    SqlAdminUser = $SqlAdminUser
    SqlAdminPassword = $SqlAdminPassword
    SolrCorePrefix = $Prefix
    SolrURL = $SolrUrl
    SqlCorePassword = $SecurePassword
    SqlMasterPassword = $SecurePassword
    SqlWebPassword = $SecurePassword
    SqlReportingPassword = $SecurePassword
    SqlProcessingPoolsPassword = $SecurePassword
    SqlProcessingTasksPassword = $SecurePassword
    SqlReferenceDataPassword = $SecurePassword
    SqlMarketingAutomationPassword = $SecurePassword
    SqlFormsPassword = $SecurePassword
    XConnectCollectionService = "https://$xConnectSiteName"
  }
  Install-SitecoreConfiguration @sitecoreParams
        ]]>
      </ScriptMap>
      <ScriptMap location="UNINSTALL">
        <![CDATA[
     
  RemoveService("$xConnectSiteName-MarketingAutomationService")
  RemoveService("$xConnectSiteName-IndexWorker")
  
  RemoveSolrCores
  
  RemoveDatabase("Core")
  RemoveDatabase("EXM.Master")
  RemoveDatabase("ExperienceForms")
  RemoveDatabase("MarketingAutomation")
  RemoveDatabase("Master")
  RemoveDatabase("Messaging")
  RemoveDatabase("Processing.Pools")
  RemoveDatabase("Processing.Tasks")
  RemoveDatabase("ReferenceData")
  RemoveDatabase("Reporting")
  RemoveDatabase("Web")
  RemoveDatabase("Xdb.Collection.Shard0")
  RemoveDatabase("Xdb.Collection.Shard1")
  RemoveDatabase("Xdb.Collection.ShardMapManager")
  
  RemoveWebsite($xConnectSiteName)
  RemoveWebsite($SiteName)   
  
  RemoveFolder($SiteFolder)
  RemoveFolder($xConnectSiteFolder)   
        ]]>
      </ScriptMap>
    </ScriptMaps>
    <Fields>
      <Field name="xconnectsitename" type="text" map="XCONNECT_SITE" label="X Connect Site Name" description="The Name of the xConnect Website"  defaultValue="[[PREFIX]].xconnect"/>
      <Field name="sitename" type="text" map="SITENAME" label="Site Name" description="The Name of the Website"  defaultValue="[[PREFIX]].sc"/>
    </Fields>
  </Configuration>
</Configurations>
